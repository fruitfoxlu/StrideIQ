<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Running Form Analysis Web App (MVP)</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <header class="container">
    <h1>Running Form Analysis Web App (MVP)</h1>
    <p class="sub">
      Browser-only (no upload): uses MediaPipe PoseLandmarker in the browser and simple rules to estimate
      <span class="mono">overstride / knee extension / trunk lean / foot strike / leg retraction</span>.
    </p>
    <p class="warn">
      Note: This is a deployable baseline demo. Running form and running economy are complex; this tool provides
      approximate estimates and trend signals only.
    </p>
  </header>

  <main class="container grid">
    <section class="card">
      <h2>1) Input Video</h2>

      <label class="field">
        <span>Choose a side-view running video (mp4/webm):</span>
        <input id="videoFile" type="file" accept="video/*" />
      </label>
      <p class="hint">Defaults: 24 FPS sampling, 0.30s minimum step interval to avoid double counting.</p>
      <div class="requirements">
        <div class="requirements-title">Requirements (enforced)</div>
        <ul>
          <li>Side view, single runner, and consistent direction (left-to-right or right-to-left).</li>
          <li>1080p @ 30 fps (normal) or 1080p @ 240 fps (slow-motion).</li>
          <li>At least 3 seconds of running (4-6 strides).</li>
        </ul>
        <div class="requirements-note">iPhone defaults: 1080p@30 (Video) or 1080p@240 (Slo-mo) in Settings &gt; Camera.</div>
        <div class="requirements-note">Slow-motion requires a true 240 fps file (not a 30 fps export).</div>
      </div>
      <div class="requirements-example">
        <div class="requirements-title">Example: Good capture framing</div>
        <div class="video-embed">
          <iframe
            src="https://www.youtube-nocookie.com/embed/rOn74w8UJUE"
            title="Running capture example"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            allowfullscreen
          ></iframe>
        </div>
        <div class="requirements-note">Example only (not analyzable). Follow this framing for your own video.</div>
      </div>

      <div class="row">
        <button id="btnAnalyze" class="primary" disabled>Start Analysis</button>
        <button id="btnDownload" class="secondary" disabled>Download JSON</button>
      </div>

      <div class="progress">
        <div id="progressBar" class="progress-bar" style="width: 0%"></div>
      </div>
      <div id="status" class="status">Status: waiting for video</div>

      <details class="debug">
        <summary>View analysis log (debug)</summary>
        <pre id="log"></pre>
      </details>
    </section>

    <section class="card">
      <h2>2) Video & Skeleton Overlay</h2>
      <div class="video-wrap">
        <video id="video" controls playsinline></video>
        <canvas id="overlay"></canvas>
      </div>
      <p class="hint">
        Suggested capture: phone fixed, camera height near hip, side view, good lighting, subject fills ~60-90% of
        frame height.
      </p>
    </section>

    <section class="card">
      <h2>3) Results</h2>

      <div id="summary" class="summary muted">
        Not analyzed yet. Choose a video, then click "Start Analysis".
      </div>

      <h3>Form Flags (estimated by this tool)</h3>
      <ul id="flags" class="flags muted">
        <li>Not analyzed yet</li>
      </ul>

      <h3>Key Metrics (based on detected contact frames)</h3>
      <div class="table-wrap">
        <table id="metricsTable" class="metrics">
          <thead>
            <tr>
              <th>Metric</th>
              <th>Estimate (median)</th>
              <th>Interpretation</th>
            </tr>
          </thead>
          <tbody>
            <tr><td colspan="3" class="muted">Not analyzed yet</td></tr>
          </tbody>
        </table>
      </div>

      <h3>Recommendations (running economy)</h3>
      <ol id="advice" class="advice muted">
        <li>Not analyzed yet</li>
      </ol>
    </section>
  </main>

  <footer class="container footer">
    <p class="muted">
      Tech: MediaPipe PoseLandmarker (Web).
      This project is a deployable MVP reference for validating product flow and early quantification.
    </p>
  </footer>

  <script type="module" src="./app.js"></script>
</body>
</html>
